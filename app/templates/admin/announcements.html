{% extends "base.html" %}
{% block title %}Announcements - Admin{% endblock %}
{% block content %}
{% from "components/icons.html" import icon %}
<div class="page-container">
    <div class="page-header">
        <h2>{{ icon('chat') }} Announcements</h2>
        <a href="{{ url_for('admin.create_announcement') }}" class="btn btn-primary">{{ icon('add_circle', '', 20) }} New Announcement</a>
    </div>
    <div class="admin-nav">
        <a href="{{ url_for('admin.dashboard') }}" class="tab">Dashboard</a>
        <a href="{{ url_for('admin.users') }}" class="tab">Users</a>
        <a href="{{ url_for('admin.reports') }}" class="tab">Reports</a>
        <a href="{{ url_for('admin.staff_notes') }}" class="tab">Staff Notes</a>
        <a href="{{ url_for('admin.community_notes') }}" class="tab">Community Notes</a>
        <a href="{{ url_for('admin.announcements') }}" class="tab active">Announcements</a>
        <a href="{{ url_for('admin.site_settings') }}" class="tab">Settings</a>
        <a href="{{ url_for('admin.audit_log_view') }}" class="tab">Audit Log</a>
    </div>
    <div class="admin-table">
        {% for ann in announcements %}
        <div class="admin-row">
            <div>
                <strong>{{ ann.title }}</strong>
                <span class="badge">{{ ann.type }}</span>
                {% if ann.is_active %}<span class="badge badge-success">Active</span>{% else %}<span class="badge">Inactive</span>{% endif %}
                <p>{{ ann.content[:100] }}</p>
                <small>By @{{ ann.author_name }} Â· {{ ann.created_at[:10] }}</small>
            </div>
            <div class="admin-actions">
                <form method="POST" action="{{ url_for('admin.toggle_announcement', ann_id=ann.id) }}" class="inline-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <button type="submit" class="btn btn-sm btn-outlined">{{ 'Deactivate' if ann.is_active else 'Activate' }}</button>
                </form>
                <form method="POST" action="{{ url_for('admin.delete_announcement', ann_id=ann.id) }}" class="inline-form"
                      onsubmit="return confirm('Delete this announcement?')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </div>
        </div>
        {% else %}
        <div class="empty-state">{{ icon('chat') }}<p>No announcements yet.</p></div>
        {% endfor %}
    </div>
</div>
{% endblock %}
