{% extends "base.html" %}
{% block title %}{{ profile_user.display_name }} (@{{ profile_user.username }}) - {{ site_settings.get('site_name', 'Chirp') }}{% endblock %}
{% block content %}
{% from "components/icons.html" import icon %}
{% from "components/badges.html" import verification_badges %}
<div class="page-container">
    <div class="page-header">
        <a href="javascript:history.back()" class="btn-icon">
            {{ icon('arrow_back') }}
        </a>
        <div>
            <h2>{{ profile_user.display_name }}</h2>
            <small>{{ post_count }} chirps</small>
        </div>
    </div>

    <div class="profile-section">
        <div class="profile-banner" style="background: {% if profile_user.banner_pic %}url('{{ profile_user.banner_pic }}'){% else %}linear-gradient(135deg, var(--md-sys-color-primary), var(--md-sys-color-tertiary)){% endif %}; background-size: cover;">
        </div>
        <div class="profile-info-section">
            <div class="profile-avatar-row">
                <img src="{{ profile_user.profile_pic or url_for('static', filename='img/default-avatar.svg') }}" alt="{{ profile_user.username }}" class="avatar-lg profile-avatar{% if profile_user.is_corp_verified %} corp-avatar{% endif %}">
                <div class="profile-actions">
                    {% if is_own_profile %}
                    <a href="{{ url_for('auth.edit_profile') }}" class="btn btn-outlined">Edit profile</a>
                    {% else %}
                    <form method="POST" action="{{ url_for('auth.follow', user_id=profile_user.id) }}" class="inline-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="btn {% if is_following %}btn-outlined{% else %}btn-primary{% endif %}">
                            {{ 'Following' if is_following else 'Follow' }}
                        </button>
                    </form>
                    {% if current_user and current_user.is_corp_verified %}
                    <form method="POST" action="{{ url_for('auth.affiliate_user', user_id=profile_user.id) }}" class="inline-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="btn {% if profile_user.affiliated_with == current_user.id %}btn-outlined{% else %}btn-tonal{% endif %}">
                            {{ icon('business', '', 18) }}
                            {{ 'Unaffiliate' if profile_user.affiliated_with == current_user.id else 'Affiliate' }}
                        </button>
                    </form>
                    {% endif %}
                    {% endif %}
                </div>
            </div>

            <div class="profile-details">
                <h2 class="profile-name">
                    {{ profile_user.display_name }}
                    {{ verification_badges(profile_user) }}
                </h2>
                <span class="profile-username">@{{ profile_user.username }}</span>

                {% if profile_user.bio %}
                <p class="profile-bio">{{ profile_user.bio }}</p>
                {% endif %}

                <div class="profile-meta">
                    {% if profile_user.location %}
                    <span>{{ icon('location_on') }} {{ profile_user.location }}</span>
                    {% endif %}
                    {% if profile_user.website %}
                    <span>{{ icon('link') }} <a href="{{ profile_user.website }}" rel="nofollow noopener" target="_blank">{{ profile_user.website[:30] }}</a></span>
                    {% endif %}
                    <span>{{ icon('calendar_month') }} Joined {{ profile_user.created_at[:10] }}</span>
                </div>

                <div class="profile-stats">
                    <span><strong>{{ following_count }}</strong> Following</span>
                    <span><strong>{{ follower_count }}</strong> Followers</span>
                </div>
            </div>
        </div>
    </div>

    <div class="posts-list">
        {% from "components/post_card.html" import render_post %}
        {% for post in posts %}
        {{ render_post(post) }}
        {% else %}
        <div class="empty-state">
            {{ icon('chat_bubble') }}
            <p>No chirps yet</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
