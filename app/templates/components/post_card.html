{% from "components/icons.html" import icon %}
{% from "components/badges.html" import verification_badges %}
{% macro render_post(post, show_actions=true) %}
<article class="post-card" id="post-{{ post.id }}">
    {% if post.get('staff_notes') %}
    {% for note in post.staff_notes %}
    <div class="staff-note staff-note-{{ note.note_type }}">
        {{ icon('shield') }}
        <strong>Staff Note ({{ note.note_type }}):</strong> {{ note.content }}
        <small>— {{ note.display_name }}</small>
    </div>
    {% endfor %}
    {% endif %}

    <div class="post-header">
        <a href="{{ url_for('auth.profile', username=post.username) }}" class="post-author">
            <img src="{{ post.profile_pic or url_for('static', filename='img/default-avatar.svg') }}" alt="" class="avatar{% if post.is_corp_verified %} corp-avatar{% endif %}">
            <div class="author-info">
                <span class="display-name">
                    {{ post.display_name }}
                    {{ verification_badges(post) }}
                </span>
                <span class="username">@{{ post.username }}</span>
            </div>
        </a>
        <a href="{{ url_for('posts.view_post', post_id=post.id) }}" class="post-time">
            {{ post.created_at[:16] }}
        </a>
    </div>

    <div class="post-content">
        {{ post.content | replace('\n', '<br>') | safe }}
        {% if post.is_edited %}
        <span class="edited-label">(edited)</span>
        {% endif %}
    </div>

    {% if post.get('quoted_post') %}
    <div class="quoted-post">
        <div class="post-header">
            <a href="{{ url_for('auth.profile', username=post.quoted_post.username) }}" class="post-author">
                <img src="{{ post.quoted_post.profile_pic or url_for('static', filename='img/default-avatar.svg') }}" alt="" class="avatar-sm{% if post.quoted_post.is_corp_verified %} corp-avatar{% endif %}">
                <span class="display-name">{{ post.quoted_post.display_name }}
                    {{ verification_badges(post.quoted_post) }}
                </span>
                <span class="username">@{{ post.quoted_post.username }}</span>
            </a>
        </div>
        <div class="post-content">{{ post.quoted_post.content }}</div>
    </div>
    {% endif %}

    {% if post.get('community_notes') %}
    {% for note in post.community_notes %}
    <div class="community-note">
        {{ icon('rate_review') }}
        <div class="note-content">
            <strong>Community Note:</strong> {{ note.content }}
            <small class="note-meta">{{ note.helpful_count }} found helpful · {{ note.category }}</small>
        </div>
    </div>
    {% endfor %}
    {% endif %}

    {% if show_actions %}
    <div class="post-actions">
        <a href="{{ url_for('posts.view_post', post_id=post.id) }}" class="action-btn">
            {{ icon('chat_bubble') }}
            <span>{{ post.reply_count or 0 }}</span>
        </a>

        <form method="POST" action="{{ url_for('posts.repost', post_id=post.id) }}" class="inline-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit" class="action-btn repost-btn">
                {{ icon('repeat') }}
                <span>{{ post.repost_count or 0 }}</span>
            </button>
        </form>

        <form method="POST" action="{{ url_for('posts.like_post', post_id=post.id) }}" class="inline-form like-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit" class="action-btn like-btn {% if post.is_liked %}liked{% endif %}">
                {{ icon('favorite' if post.is_liked else 'favorite_border') }}
                <span>{{ post.like_count or 0 }}</span>
            </button>
        </form>

        <form method="POST" action="{{ url_for('posts.bookmark_post', post_id=post.id) }}" class="inline-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit" class="action-btn bookmark-btn {% if post.is_bookmarked %}bookmarked{% endif %}">
                {{ icon('bookmark' if post.is_bookmarked else 'bookmark_border') }}
            </button>
        </form>

        <button class="action-btn share-btn" onclick="sharePost({{ post.id }})">
            {{ icon('share') }}
        </button>
    </div>
    {% endif %}
</article>
{% endmacro %}
