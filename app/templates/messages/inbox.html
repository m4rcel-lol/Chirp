{% extends "base.html" %}
{% block title %}Messages - {{ site_settings.get('site_name', 'Chirp') }}{% endblock %}
{% block content %}
{% from "components/icons.html" import icon %}
<div class="page-container">
    <div class="page-header">
        <h2>Messages</h2>
        <a href="{{ url_for('messages.new_conversation') }}" class="btn btn-primary btn-sm">
            {{ icon('edit') }} New
        </a>
    </div>

    <div class="conversations-list">
        {% for conv in conversations %}
        <a href="{{ url_for('messages.conversation', conv_id=conv.id) }}" class="conversation-item {% if conv.unread_count > 0 %}unread{% endif %}">
            <div class="conv-avatars">
                {% for member in conv.members[:3] %}
                <img src="{{ member.profile_pic or url_for('static', filename='img/default-avatar.svg') }}" alt="" class="avatar-sm">
                {% endfor %}
            </div>
            <div class="conv-info">
                <div class="conv-header">
                    <span class="conv-names">
                        {% for member in conv.members %}{{ member.display_name }}{% if not loop.last %}, {% endif %}{% endfor %}
                    </span>
                    <span class="conv-time">{{ conv.last_message_at[:10] if conv.last_message_at else '' }}</span>
                </div>
                <p class="conv-preview">{{ conv.last_message[:50] if conv.last_message else 'No messages yet' }}</p>
            </div>
            {% if conv.unread_count > 0 %}
            <span class="badge">{{ conv.unread_count }}</span>
            {% endif %}
        </a>
        {% else %}
        <div class="empty-state">
            {{ icon('mail') }}
            <p>No conversations yet</p>
            <a href="{{ url_for('messages.new_conversation') }}" class="btn btn-primary">Start a conversation</a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
